# レビューガイドライン

## 目的
- **一般的なレビュー観点**と、
- 本リポジトリのコンセプトである**「下流（実装）→上流（設計/仕様/要件/ヒアリング）」の逆算整合性**

を同時に担保する。

---

## 1. 一般的なレビュー観点（ベースライン）
### 1.1 正しさ
- 仕様通りに動くか
- 境界/異常系の考慮があるか

### 1.2 可読性/保守性
- 命名が一貫しているか
- 責務が明確か
- 重複や密結合がないか

### 1.3 テスト
- 重要ロジックにユニットテストがあるか
- 失敗/境界ケースが含まれているか

### 1.4 セキュリティ/信頼性
- 入力バリデーションがあるか
- 例外が握りつぶされていないか

---

## 2. 逆算整合性レビュー（本リポジトリの核心）

### 2.1 目的
「理想実装 → 設計書 → 仕様書 → 要件定義 → ヒアリングInput」
が**矛盾なく連鎖**しているかを確認する。

### 2.2 逆算チェーンの定義
- **実装（最終）**: Clean Architecture + 型 + テスト
- **設計書**: 上記実装を必然化する構成/命名/依存方向
- **仕様書**: 設計書が要求する機能/挙動
- **要件定義**: 仕様書を導く制約/優先/範囲
- **ヒアリングInput**: 要件定義を導く情報

### 2.3 逆算整合性チェック（Input/Output）
#### A. 実装 → 設計書
- 実装が**設計書通りの構成/命名/依存方向**になっているか
- 設計書は**実装がそうなるように指示**できているか

#### B. 設計書 → 仕様書
- 仕様書は**設計書が求める責務/構成**を満たす機能を定義しているか
- 設計書が**仕様書に必要な粒度/範囲**を明示しているか

#### C. 仕様書 → 要件定義
- 要件定義が**仕様書の必要条件**を満たすか
- 要件定義に**非目標/制約**が明示されているか

#### D. 要件定義 → ヒアリングInput
- ヒアリング項目が**要件定義を導ける内容**か
- Input/Outputが**具体的に定義**されているか

---

## 3. 理想実装の妥当性レビュー

### 3.1 最適性（Best Implementation）
- 現在の制約/目的に対して**最短距離で価値を出す実装**か
- 目的に対して過剰/過小な構成になっていないか

### 3.2 ベストプラクティス
- 依存方向（外→内）が守られているか
- レイヤー責務が混ざっていないか
- 入力バリデーション/例外処理があるか

### 3.3 アンチパターン排除
- 依存方向の逆流
- ゴッドクラス/スパゲッティ化
- 隠れたグローバル状態

---

## 4. 本リポジトリ固有のレビュー観点

### 4.1 クリーンアーキテクチャ遵守
- レイヤー: Domain/Application/Infrastructure/Interface
- 依存方向: 外 → 内 のみ
- 命名規約: `*UseCase` / `*Entity` / `*Repository` / `*DTO`

### 4.2 TypeScriptの型徹底
- `any`（暗黙含む）を使っていないか
- 主要なI/Oが型で表現されているか

### 4.3 日本語の説明
- コメント/テストケース名/説明が日本語になっているか
- AIが読み取れる粒度で書かれているか

### 4.4 テストの網羅性
- 成功/失敗/境界ケースがあるか
- テストがUseCaseの責務をカバーしているか

### 4.5 ドキュメント整合性
- docs/ai が**実装の必然性**を説明しているか
- docs/implementation が**実装と一致**しているか
- README/AGENTSが**意図と運用**を明確にしているか

---

## 5. AI指示（AGENTS）の最適性

### 5.1 ルートAGENTS
- 全体の思想/ゴール/禁止事項が明確か

### 5.2 階層AGENTS
- docs/ と src/ で**粒度に応じた指示**があるか
- 逆算プロセスに必要な**Input/Output**が明文化されているか

---

## 6. レビュー時のチェックリスト（最小）
- [ ] 実装が設計書と一致している
- [ ] 設計書が仕様書を必然化している
- [ ] 仕様書が要件定義を必然化している
- [ ] 要件定義がヒアリングInputを必然化している
- [ ] Input/Outputが明確に定義されている
- [ ] クリーンアーキテクチャの依存方向が守られている
- [ ] 型が徹底されている（anyなし）
- [ ] テストが成功/失敗/境界を含む
- [ ] 日本語の説明が徹底されている
- [ ] 実装が目的に対して最適か

---

## 7. 運用ルール（推奨）
- レビューは「一般論 → 逆算整合性 → 理想実装妥当性 → 実装詳細」の順で行う
- 指摘は「どの層のInput/Outputが欠けているか」で示す
